-- CREATE DATABASE ORG;
SHOW DATABASES;
USE ORG;

CREATE TABLE WORKER (
  WORKER_ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
  FIRST_NAME CHAR(25),
  LAST_NAME CHAR(25),
  SALARY NUMERIC(15),
  JOINING_DATE DATETIME,
  DEPARTMENT CHAR(25)
);

-- inesrt data to worker
INSERT INTO WORKER 
  (FIRST_NAME, LAST_NAME, SALARY, JOINING_DATE, DEPARTMENT) VALUES
    ('Monika', 'Arora', 100000, '21-02-20 09:00:00', 'HR'),
    ('Niharika', 'Verma', 80000, '21-06-11 09:00:00', 'Admin'),
    ('Vishal', 'Singhal', 300000, '21-02-20 09:00:00', 'HR'),
    ('Mohan', 'Sarah', 300000, '12-03-19 09:00:00', 'Admin'),
    ('Amitabh', 'Singh', 500000, '21-02-20 09:00:00', 'Admin'),
    ('Vivek', 'Bhati', 490000, '21-06-11 09:00:00', 'Admin'),
    ('Vipul', 'Diwan', 200000, '21-06-11 09:00:00', 'Account'),
    ('Satish', 'Kumar', 75000, '21-01-20 09:00:00', 'Account'),
    ('Geetika', 'Chauhan', 90000, '21-04-11 09:00:00', 'Admin');

-- create table bonus
CREATE TABLE BONUS (
  WORKER_REF_ID INTEGER,
  BONUS_AMOUNT NUMERIC(10),
  BONUS_DATE DATETIME,
  FOREIGN KEY (WORKER_REF_ID) REFERENCES Worker(WORKER_ID)
);

SELECT * FROM WORKER;
-- 1
INSERT INTO BONUS VALUES (6, 32000, '2021-11-02');
INSERT INTO BONUS VALUES (6, 20000, '2022-11-02');
INSERT INTO BONUS VALUES (5, 21000, '2021-11-02');
INSERT INTO BONUS VALUES (9, 30000, '2021-11-02');
INSERT INTO BONUS VALUES (8, 4500, '2022-11-02');
SELECT * FROM BONUS;

-- 2
SELECT *
FROM WORKER
ORDER BY SALARY DESC LIMIT 1 OFFSET 1;
-- 2
select max(salary) SecondHighestSalary
from WORKER
where salary <> (select max(salary) from WORKER);

-- 3 Brenda
SELECT
department, first_name, last_name, salary
FROM worker
WHERE 
(
department, 
salary
) IN (
	SELECT 
    department, 
    MAX(Salary)
	FROM worker
    GROUP BY department
);
-- 3 with整個表直接inner join
WITH WORKER2 AS (SELECT MAX(SALARY) SALARY, DEPARTMENT FROM WORKER GROUP BY DEPARTMENT)
SELECT 
W1.FIRST_NAME, W1.LAST_NAME, 
W1.SALARY, W1.DEPARTMENT
FROM WORKER W1, WORKER2 W2
WHERE W1.SALARY = W2.SALARY
AND W1.DEPARTMENT = W2.DEPARTMENT
;
-- 3 EXISTS前要with整好個表先
with w2 as (SELECT MAX(SALARY) SALARY, DEPARTMENT
FROM WORKER W2
GROUP BY W2.DEPARTMENT)
select
W1.FIRST_NAME, 
W1.LAST_NAME, 
W1.SALARY, 
W1.DEPARTMENT
FROM WORKER W1
WHERE EXISTS (SELECT * FROM w2 WHERE W1.SALARY = W2.SALARY AND W1.DEPARTMENT = W2.DEPARTMENT)
;
-- 3 left join 都係要with 同inner join 一樣


-- 4
SELECT W1.WORKER_ID, W1.FIRST_NAME, W1.LAST_NAME, W2.WORKER_ID, W2.FIRST_NAME, W2.LAST_NAME, W1.SALARY
FROM WORKER W1, WORKER W2
WHERE W1.SALARY = W2.SALARY
-- AND W1.FIRST_NAME <> W2.FIRST_NAME
-- AND W1.LAST_NAME <> W2.LAST_NAME
AND W2.WORKER_ID > W1.WORKER_ID
;

-- 5
SELECT W.FIRST_NAME, W.LAST_NAME, W.SALARY, B.BONUS_AMOUNT
FROM WORKER W, BONUS B
WHERE W.WORKER_ID = B.WORKER_REF_ID
AND YEAR(B.BONUS_DATE) = 2021
;

-- 6
DELETE FROM WORKER;
-- 7
DROP TABLE WORKER;