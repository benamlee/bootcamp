CREATE database BEN;
use BEN;
SHOW TABLES;

CREATE TABLE REGIONS (
	REGION_ID INTEGER PRIMARY KEY,
    REGION_NAME VARCHAR(25)
);

CREATE TABLE COUNTRIES (
	COUNTRY_ID VARCHAR(2) PRIMARY KEY,
    COUNTRY_NAME VARCHAR(40),
    REGION_ID INTEGER,
    FOREIGN KEY (REGION_ID) REFERENCES REGIONS (REGION_ID)
);

CREATE TABLE LOCATIONS (
	LOCATION_ID INTEGER PRIMARY KEY,
    STREET_ADDRESS VARCHAR(25),
    POSTAL_CODE VARCHAR(12),
    CITY VARCHAR(30),
    STATE_PROVINCE VARCHAR(12),
    COUNTRY_ID VARCHAR(2),
    FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES (COUNTRY_ID)
);

CREATE TABLE DEPARTMENTS (
	DEPARTMENT_ID INTEGER PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR(30),
    MANAGER_ID INTEGER,
    LOCATION_ID INTEGER,
    FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID)
);
DROP TABLE EMPLOYEES;
CREATE TABLE EMPLOYEES (
	EMPLOYEE_ID INTEGER,
    FIRST_NAME VARCHAR(20),
    LAST_NAME VARCHAR(25),
    EMAIL VARCHAR(25),
    PHONE_NUMBER VARCHAR(20),
    HIRE_DATE DATE,
    JOB_ID VARCHAR(10),
    SALARY INTEGER,
    COMMISSION_PCT INTEGER,
    MANAGER_ID INTEGER,
    DEPARTMENT_ID INTEGER,
    FOREIGN KEY (JOB_ID) REFERENCES JOBS (JOB_ID),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS (DEPARTMENT_ID),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES JOB_HISTORY (EMPLOYEE_ID)
);

CREATE TABLE JOBS (
	JOB_ID VARCHAR(10) PRIMARY KEY,
    JOB_TITLE VARCHAR(35),
    MIN_SALARY INTEGER,
    MAX_SALARY INTEGER
);
drop table JOB_HISTORY;
CREATE TABLE JOB_HISTORY (
	EMPLOYEE_ID INTEGER,
    START_DATE DATE,
    END_DATE DATE,
    JOB_ID VARCHAR(10),
    DEPARTMENT_ID INTEGER,
    PRIMARY KEY (EMPLOYEE_ID, START_DATE),
    FOREIGN KEY (JOB_ID) REFERENCES JOBS (JOB_ID),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS (DEPARTMENT_ID)
);
drop table job_grades;
CREATE TABLE JOB_GRADES (
	GRADE_LEVEL VARCHAR(2) PRIMARY KEY,
    LOWEST_SAL INTEGER,
    HIGHEST_SAL INTEGER
);

INSERT INTO REGIONS VALUES (1, 'EUROPE');
INSERT INTO REGIONS VALUES (2, 'Asia & Pacific');
INSERT INTO REGIONS VALUES (3, 'North America');
INSERT INTO COUNTRIES VALUES ('DE', 'Germany', 1);
INSERT INTO COUNTRIES VALUES ('IT', 'Italy', 1);
INSERT INTO COUNTRIES VALUES ('JP', 'Japan', 3);
INSERT INTO COUNTRIES VALUES ('US', 'United State', 2);
INSERT INTO LOCATIONS VALUES (1000, '1297 Via Cola di Rie', 989, 'Roma', null, 'IT');
INSERT INTO LOCATIONS VALUES (1100, '93091 Calle della Te', 10934, 'Venice', null, 'IT');
INSERT INTO LOCATIONS VALUES (1200, '2017 Shinjuku-ku', 1689, 'Tokyo', 'Tokyo Prefec', 'JP');
INSERT INTO LOCATIONS VALUES (1400, '2014 Jabberwocky Rd', 26192, 'Southlake', 'Texas', 'US');
INSERT INTO DEPARTMENTS VALUES (10, 'Administration', 200, 1100);
INSERT INTO DEPARTMENTS VALUES (20, 'Marketing', 201, 1200);
INSERT INTO DEPARTMENTS VALUES (30, 'Purchasing', 202, 1400);
INSERT INTO JOBS VALUES ('MK_REP', 'AAA', 100, 1000);
INSERT INTO JOBS VALUES ('ST_CLERK', 'BBB', 100, 1000);
INSERT INTO JOBS VALUES ('IT_PROG', 'CCC', 100, 1000);
INSERT INTO JOB_HISTORY VALUES (102, '1993-01-13', '1998-07-24', 'IT_PROG', 20);
INSERT INTO JOB_HISTORY VALUES (101, '1989-09-21', '1993-10-27', 'MK_REP', 10);
INSERT INTO JOB_HISTORY VALUES (101, '1993-10-28', '1997-03-15', 'MK_REP', 30);
INSERT INTO JOB_HISTORY VALUES (100, '1996-02-17', '1999-12-19', 'ST_CLERK', 30);
INSERT INTO JOB_HISTORY VALUES (103, '1998-03-24', '1999-12-31', 'MK_REP', 20);
INSERT INTO EMPLOYEES VALUES (100, 'Steven', 'King', 'SKING', '515-1234567', '1987-06-17', 'ST_CLERK', 24000.00, 0.00, 109, 10);
INSERT INTO EMPLOYEES VALUES (101, 'Neena', 'Kochhar', 'NKOCHHAR', '515-1234568', '1987-06-18', 'MK_REP', 17000.00, 0.00, 103, 20);
INSERT INTO EMPLOYEES VALUES (102, 'Lex', 'De Haan', 'LDEHAAN', '515-1234569', '1987-06-19', 'IT_PROG', 17000.00, 0.00, 108, 30);
INSERT INTO EMPLOYEES VALUES (103, 'Alexander', 'Hunold', 'AHUNOLD', '590-4234567', '1987-06-20', 'MK_REP', 9000.00, 0.00, 105, 20);
SELECT * FROM REGIONS;
SELECT * FROM COUNTRIES;
SELECT * FROM LOCATIONS;
SELECT * FROM DEPARTMENTS;
SELECT * FROM JOBS;
SELECT * FROM JOB_HISTORY;
SELECT * FROM EMPLOYEES;
SELECT * FROM JOB_GRADES;

-- 3
SELECT LOCATION_ID, STREET_ADDRESS, CITY, STATE_PROVINCE, COUNTRY_NAME
FROM LOCATIONS, COUNTRIES
WHERE LOCATIONS.COUNTRY_ID = COUNTRIES.COUNTRY_ID
;

-- 4
SELECT FIRST_NAME, LAST_NAME, DEPARTMENT_ID FROM EMPLOYEES;

-- 5
SELECT E.FIRST_NAME, E.LAST_NAME, E.JOB_ID, D.DEPARTMENT_ID 
FROM EMPLOYEES E, DEPARTMENTS D, LOCATIONS L, COUNTRIES C
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID
AND L.COUNTRY_ID = C.COUNTRY_ID
AND COUNTRY_NAME = 'Japan'
;

-- 6
INSERT INTO JOB_HISTORY VALUES (105, '1991-01-01', '1999-12-31', 'MK_REP', 20);
INSERT INTO JOB_HISTORY VALUES (108, '1991-01-01', '1999-12-31', 'IT_PROG', 30);
INSERT INTO JOB_HISTORY VALUES (109, '1991-01-01', '1999-12-31', 'ST_CLERK', 10);
INSERT INTO EMPLOYEES VALUES (105, 'Bennn', 'Leeee', 'BBBLLL', '515-1234560', '1987-06-20', 'MK_REP', 100000.00, 0.00, 110, 20);
INSERT INTO EMPLOYEES VALUES (108, 'Kennn', 'Chann', 'KKKCCC', '515-1234570', '1987-06-21', 'IT_PROG', 100000.00, 0.00, 110, 30);
INSERT INTO EMPLOYEES VALUES (109, 'Chrisss', 'Lauuu', 'CCCLLL', '515-1234580', '1987-06-22', 'ST_CLERK', 100000.00, 0.00, 110, 10);
SELECT * FROM JOB_HISTORY;
SELECT * FROM EMPLOYEES;
SELECT E1.EMPLOYEE_ID, E1.LAST_NAME, E1.MANAGER_ID, E2.LAST_NAME
FROM EMPLOYEES E1, EMPLOYEES E2
WHERE E1.MANAGER_ID = E2.EMPLOYEE_ID
;

-- 7
SELECT FIRST_NAME, LAST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE HIRE_DATE > '1987-06-19'
;

-- 8
SELECT D.DEPARTMENT_NAME, COUNT(*) AS NUMBER_OF_EMPLOYEES
FROM DEPARTMENTS D, EMPLOYEES E
WHERE D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY E.DEPARTMENT_ID
;

-- 9
SELECT H.EMPLOYEE_ID, J.JOB_TITLE, DATEDIFF(H.END_DATE, H.START_DATE) AS NUMBER_OF_DAYS_BETWEEN_ENDING_DATE_AND_STARTING_DATE
FROM JOB_HISTORY H, JOBS J
WHERE H.JOB_ID = J.JOB_ID
AND H.DEPARTMENT_ID = 30
;

-- 10
INSERT INTO JOB_HISTORY VALUES (200, '1991-01-01', '1999-12-31', 'MK_REP', 10);
INSERT INTO JOB_HISTORY VALUES (201, '1991-01-01', '1999-12-31', 'IT_PROG', 20);
INSERT INTO JOB_HISTORY VALUES (202, '1991-01-01', '1999-12-31', 'ST_CLERK', 30);
INSERT INTO EMPLOYEES VALUES (200, 'Winnn', 'Huiii', 'WWWHHH', '515-1234500', '1987-06-23', 'MK_REP', 1000000.00, 0.00, null, 10);
INSERT INTO EMPLOYEES VALUES (201, 'Tinnn', 'Chauu', 'TTTCCC', '515-1234600', '1987-06-24', 'IT_PROG', 1000000.00, 0.00, null, 20);
INSERT INTO EMPLOYEES VALUES (202, 'Pinnn', 'Loooo', 'PPPLLL', '515-1234700', '1987-06-25', 'ST_CLERK', 1000000.00, 0.00, null, 30);
SELECT * FROM DEPARTMENTS;
SELECT * FROM EMPLOYEES;
SELECT D.DEPARTMENT_NAME, CONCAT(E.FIRST_NAME, ' ', E.LAST_NAME) AS MANAGER_NAME, L.CITY, C.COUNTRY_NAME
FROM DEPARTMENTS D, LOCATIONS L, COUNTRIES C, EMPLOYEES E
WHERE D.LOCATION_ID = L.LOCATION_ID
AND L.COUNTRY_ID = C.COUNTRY_ID
AND D.MANAGER_ID = E.EMPLOYEE_ID
;

-- 11
SELECT D.DEPARTMENT_NAME, AVG(E.SALARY) AS AVERAGE_SALARY
FROM DEPARTMENTS D, EMPLOYEES E
WHERE D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY E.DEPARTMENT_ID
;

-- 12
ALTER TABLE JOBS
ADD GRADE_LEVEL VARCHAR(2)
;
-- UPDATE JOBS J
-- SET J.GRADE_LEVEL = 
-- FROM JOB_GRADES G
-- WHERE J.MIN_SALARY = G.LOWEST_SAL
-- AND J.MAX_SALARY = G.HIGHEST_SAL;

